<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Secure Document Vault - Home</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- PWA (adapted for multi-page, but focused on index) -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="SecureVault">
    <!-- Apple icon -->
    <link rel="apple-touch-icon" href="Screenshot 2025-12-31 022232.png">
    <!-- Fallback favicon -->
    <link rel="icon" href="Screenshot 2025-12-31 022232.png" type="image/png">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Custom CSS: Minimal overrides for theme synergy with Bootstrap -->
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .hero-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .document-card { transition: transform 0.3s ease, box-shadow 0.3s ease; border: 2px dashed #ddd; }
        .document-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); }
        .document-card.upload-mode { border-color: #667eea; background: linear-gradient(135deg, #f0f2ff, #e8eaff); }
        .document-card.stored-mode { border-color: #28a745; background: linear-gradient(135deg, #f8fff8, #e8ffe8); }
        .icon { font-size: 3em; margin-bottom: 15px; display: block; }
        .aadhar .icon { color: #ff6b6b; } .pan .icon { color: #4ecdc4; } .license .icon { color: #45b7d1; }
        .upload-btn { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 24px; border-radius: 25px; transition: background 0.3s ease; margin-top: 10px; }
        .upload-btn:hover { background: linear-gradient(135deg, #5a6fd8, #6a4190); }
        .file-input { display: none; }
        .preview { max-width: 100%; max-height: 200px; border-radius: 10px; margin: 10px auto; display: none; cursor: pointer; }
        .status { margin-top: 10px; font-size: 0.9em; font-weight: bold; }
        .status.upload-ready { color: #667eea; } .status.stored { color: #28a745; }
        .action-buttons { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
        .download-btn { background: linear-gradient(135deg, #007bff, #0056b3); color: white; border: none; padding: 8px 16px; border-radius: 15px; transition: background 0.3s ease; }
        .download-btn:hover { background: linear-gradient(135deg, #0056b3, #004085); }
        .remove-btn { background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 15px; transition: background 0.3s ease; }
        .remove-btn:hover { background: #c82333; }
        .other-add-card { cursor: pointer; }
        .other-add-card:hover { background-color: rgba(102, 126, 234, 0.1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .document-card { animation: fadeIn 0.5s ease; }
        footer { background-color: #343a40; color: white; }
        @media (max-width: 576px) { .action-buttons { flex-direction: column; gap: 5px; } }
        /* Password modal custom */
        .password-modal { display: none; position: fixed; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1055; align-items: center; justify-content: center; }
        .password-container { background: white; border-radius: 15px; padding: 30px; text-align: center; box-shadow: 0 10px 20px rgba(0,0,0,0.2); max-width: 400px; }
        .password-container input { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .password-container button { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; }
        .password-container button:hover { background: linear-gradient(135deg, #5a6fd8, #6a4190); }
        .password-message { color: red; margin-top: 10px; }
    </style>
</head>
<body>

    <!-- Navbar (shared across pages) -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">SecureVault</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section (remixed with Bootstrap hero utilities) -->
    <section class="hero-bg py-5">
        <div class="container text-center py-5">
            <h1 class="display-4 fw-bold mb-4">Secure Document Vault</h1>
            <p class="lead mb-4">Safely store and manage your personal documents with end-to-end encryption. Responsive and offline-ready.</p>
            <button class="btn btn-light btn-lg" onclick="document.getElementById('vault-section').scrollIntoView({behavior: 'smooth'})">Start Securing</button>
        </div>
    </section>

    <!-- Vault Section (core document cards, remixed with Bootstrap grid/cards/modals) -->
    <section id="vault-section" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">Your Secure Vault</h2>
            <div class="row g-4 documents-grid">
                <div class="col-lg-3 col-md-6">
                    <div class="card document-card aadhar upload-mode h-100" id="aadhar-card">
                        <div class="card-body d-flex flex-column align-items-center text-center">
                            <i class="bi bi-id-badge icon"></i>
                            <h5 class="card-title title">Upload Your Aadhar Card</h5>
                            <input type="file" class="file-input" id="aadhar-input" accept="image/*,.pdf">
                            <button class="btn upload-btn" onclick="triggerUpload('aadhar')">Upload</button>
                            <div class="status upload-ready mt-auto">Ready to upload</div>
                            <img class="preview" id="aadhar-preview" alt="Aadhar Preview" style="display: none;" onclick="openModal(this.src)">
                            <div class="action-buttons mt-2" id="aadhar-actions" style="display: none;">
                                <button class="btn download-btn" onclick="downloadDocument('aadhar')">Download</button>
                                <button class="btn remove-btn" onclick="removeDocument('aadhar')">Remove</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="card document-card pan upload-mode h-100" id="pan-card">
                        <div class="card-body d-flex flex-column align-items-center text-center">
                            <i class="bi bi-credit-card icon"></i>
                            <h5 class="card-title title">Upload Your PAN Card</h5>
                            <input type="file" class="file-input" id="pan-input" accept="image/*,.pdf">
                            <button class="btn upload-btn" onclick="triggerUpload('pan')">Upload</button>
                            <div class="status upload-ready mt-auto">Ready to upload</div>
                            <img class="preview" id="pan-preview" alt="PAN Preview" style="display: none;" onclick="openModal(this.src)">
                            <div class="action-buttons mt-2" id="pan-actions" style="display: none;">
                                <button class="btn download-btn" onclick="downloadDocument('pan')">Download</button>
                                <button class="btn remove-btn" onclick="removeDocument('pan')">Remove</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="card document-card license upload-mode h-100" id="license-card">
                        <div class="card-body d-flex flex-column align-items-center text-center">
                            <i class="bi bi-car-front icon"></i>
                            <h5 class="card-title title">Upload Your Driving License</h5>
                            <input type="file" class="file-input" id="license-input" accept="image/*,.pdf">
                            <button class="btn upload-btn" onclick="triggerUpload('license')">Upload</button>
                            <div class="status upload-ready mt-auto">Ready to upload</div>
                            <img class="preview" id="license-preview" alt="License Preview" style="display: none;" onclick="openModal(this.src)">
                            <div class="action-buttons mt-2" id="license-actions" style="display: none;">
                                <button class="btn download-btn" onclick="downloadDocument('license')">Download</button>
                                <button class="btn remove-btn" onclick="removeDocument('license')">Remove</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="card document-card other-add upload-mode h-100 other-add-card" id="other-add-card">
                        <div class="card-body d-flex flex-column align-items-center justify-content-center text-center">
                            <i class="bi bi-plus-circle icon"></i>
                            <h5 class="card-title title">Add Other Document</h5>
                            <p class="card-text mb-0 text-muted">Click to upload</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Image Modal (Bootstrap modal) -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content border-0">
                <div class="modal-body p-0">
                    <img id="modal-img" src="" alt="Enlarged Preview" class="img-fluid w-100">
                </div>
            </div>
        </div>
    </div>

    <!-- Password Modal (custom overlay, but Bootstrap-styled) -->
    <div class="password-modal" id="password-modal">
        <div class="password-container">
            <h2 id="password-title">Enter Password</h2>
            <input type="password" id="password-input" class="form-control" placeholder="Password">
            <button id="submit-password" class="btn">Submit</button>
            <div class="password-message" id="password-message"></div>
        </div>
    </div>

    <!-- Other Document Modal (Bootstrap modal) -->
    <div class="modal fade" id="other-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title">Add Other Document</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <input type="text" id="other-name" class="form-control mb-3" placeholder="Document name (e.g., Passport)">
                    <input type="file" id="other-file-input" class="form-control" accept="image/*,.pdf">
                    <div id="other-message" class="text-danger mt-2"></div>
                </div>
                <div class="modal-footer border-0 justify-content-center">
                    <button id="other-upload-btn" class="btn btn-success">Upload</button>
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer (shared) -->
    <footer class="footer py-4 mt-auto">
        <div class="container text-center">
            <p>&copy; 2026 Secure Document Vault. Built with Bootstrap 5.</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- PWA Install (simplified for multi-page) -->
    <script>
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });
        // Vault JS (core functionality, remixed with Bootstrap events)
        const documents = { aadhar: null, pan: null, license: null };
        let currentKey = null;
        const knownVerification = 'secure-vault-123';
        // Crypto helpers (unchanged from previous)
        function textToBuffer(text) { return new TextEncoder().encode(text); }
        function bufferToText(buffer) { return new TextDecoder().decode(buffer); }
        function base64Encode(buffer) {
            const bytes = new Uint8Array(buffer);
            let binary = '';
            for (let i = 0; i < bytes.length; i += 32768) {
                const chunk = bytes.subarray(i, i + 32768);
                binary += String.fromCharCode.apply(null, chunk);
            }
            return btoa(binary);
        }
        function base64Decode(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) bytes[i] = binaryString.charCodeAt(i);
            return bytes;
        }
        function generateSalt() { return crypto.getRandomValues(new Uint8Array(16)); }
        async function deriveKey(password, salt) {
            const keyMaterial = await crypto.subtle.importKey('raw', textToBuffer(password), 'PBKDF2', false, ['deriveKey']);
            return crypto.subtle.deriveKey({ name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' }, keyMaterial, { name: 'AES-GCM', length: 256 }, true, ['encrypt', 'decrypt']);
        }
        async function encryptData(data, key) {
            const iv = crypto.getRandomValues(new Uint8Array(12));
            const encrypted = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, textToBuffer(data));
            return { iv: base64Encode(iv), encrypted: base64Encode(encrypted) };
        }
        async function decryptData(encryptedObj, key) {
            const iv = base64Decode(encryptedObj.iv);
            const encrypted = base64Decode(encryptedObj.encrypted);
            const decrypted = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, encrypted);
            return bufferToText(decrypted);
        }
        function slugify(name) { return name.trim().toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }
        function loadCustomRegistry() { try { return JSON.parse(localStorage.getItem('custom_docs') || '[]'); } catch(e){ return []; } }
        function saveCustomRegistry(arr) { localStorage.setItem('custom_docs', JSON.stringify(arr)); }
        function openModal(src) {
            document.getElementById('modal-img').src = src;
            new bootstrap.Modal(document.getElementById('imageModal')).show();
        }
        function showStoredDocument(docType, dataUrl) {
            const card = document.getElementById(`${docType}-card`);
            if (!card) return;
            const title = card.querySelector('.title');
            const btn = card.querySelector('.upload-btn');
            const status = card.querySelector('.status');
            const preview = card.querySelector('.preview');
            const actions = card.querySelector('.action-buttons');
            title.textContent = `Your ${docTypeLabelFromKey(docType)}`;
            btn.style.display = 'none';
            status.textContent = dataUrl.startsWith('data:application/pdf') ? 'PDF Stored (No Preview)' : 'Stored Securely';
            status.className = 'status stored';
            if (dataUrl.startsWith('data:image/')) { preview.src = dataUrl; preview.style.display = 'block'; }
            else preview.style.display = 'none';
            actions.style.display = 'flex';
            card.className = `card document-card ${docType} stored-mode h-100`;
        }
        function docTypeLabelFromKey(key) {
            if (['aadhar', 'pan', 'license'].includes(key)) return key.charAt(0).toUpperCase() + key.slice(1);
            const meta = loadCustomRegistry().find(m => m.key === key);
            return meta ? meta.label : key;
        }
        async function downloadDocument(docType) {
            let dataUrl = documents[docType];
            if (!dataUrl && currentKey) {
                const stored = localStorage.getItem(docType);
                if (stored) {
                    try {
                        const encryptedObj = JSON.parse(stored);
                        dataUrl = await decryptData(encryptedObj, currentKey);
                    } catch (e) { alert('Decrypt failed: ' + e.message); return; }
                }
            }
            if (!dataUrl) return;
            const link = document.createElement('a');
            link.href = dataUrl;
            const ext = dataUrl.split(';')[0].split('/')[1] === 'pdf' ? 'pdf' : 'jpg';
            link.download = `${docType}.${ext}`;
            link.click();
        }
        async function removeDocument(docType) {
            const label = docTypeLabelFromKey(docType);
            if (!confirm(`Remove "${label}"?`)) return;
            localStorage.removeItem(docType);
            if (!['aadhar','pan','license'].includes(docType)) {
                let registry = loadCustomRegistry();
                registry = registry.filter(m => m.key !== docType);
                saveCustomRegistry(registry);
            }
            const card = document.getElementById(`${docType}-card`);
            if (card && ['aadhar','pan','license'].includes(docType)) {
                const title = card.querySelector('.title');
                const btn = card.querySelector('.upload-btn');
                const status = card.querySelector('.status');
                const preview = card.querySelector('.preview');
                const actions = card.querySelector('.action-buttons');
                title.textContent = `Upload Your ${label}`;
                btn.style.display = 'block';
                status.textContent = 'Ready to upload'; status.className = 'status upload-ready';
                preview.style.display = 'none'; preview.src = '';
                actions.style.display = 'none';
                card.className = `card document-card ${docType} upload-mode h-100`;
                documents[docType] = null;
                document.getElementById(`${docType}-input`).value = '';
            } else if (card) {
                card.parentNode.removeChild(card);
            }
        }
        function createCustomCardElement(key, label) {
            const grid = document.querySelector('.documents-grid');
            const col = document.createElement('div');
            col.className = 'col-lg-3 col-md-6';
            col.innerHTML = `
                <div class="card document-card ${key} stored-mode h-100">
                    <div class="card-body d-flex flex-column align-items-center text-center">
                        <i class="bi bi-folder icon"></i>
                        <h5 class="card-title title">Your ${label}</h5>
                        <div class="status stored mt-auto">Stored Securely</div>
                        <img class="preview" id="${key}-preview" alt="${label} Preview" style="display:none;">
                        <div class="action-buttons mt-2">
                            <button class="btn download-btn" onclick="downloadDocument('${key}')">Download</button>
                            <button class="btn remove-btn" onclick="removeDocument('${key}')">Remove</button>
                        </div>
                    </div>
                </div>
            `;
            const addCol = document.querySelector('.other-add-card').closest('.col-lg-3');
            addCol.parentNode.insertBefore(col, addCol);
            col.querySelector('.preview').onclick = (e) => openModal(e.target.src);
        }
        async function createAndStoreCustomDoc(label, dataUrl) {
            let base = 'other-' + slugify(label || 'document');
            let key = base;
            const registry = loadCustomRegistry();
            let counter = 1;
            while (registry.some(r => r.key === key) || localStorage.getItem(key)) key = `${base}-${counter++}`;
            const encrypted = await encryptData(dataUrl, currentKey);
            localStorage.setItem(key, JSON.stringify(encrypted));
            registry.unshift({ key, label });
            saveCustomRegistry(registry);
            createCustomCardElement(key, label);
            showStoredDocument(key, dataUrl);
        }
        async function initDocuments() {
            for (const docType of Object.keys(documents)) {
                const stored = localStorage.getItem(docType);
                if (stored && currentKey) {
                    try {
                        const encryptedObj = JSON.parse(stored);
                        const dataUrl = await decryptData(encryptedObj, currentKey);
                        documents[docType] = dataUrl;
                        showStoredDocument(docType, dataUrl);
                    } catch (e) { console.error(`Decrypt ${docType}: ${e}`); }
                }
            }
            const registry = loadCustomRegistry();
            for (const meta of registry) {
                const { key, label } = meta;
                const stored = localStorage.getItem(key);
                if (stored && currentKey) {
                    try {
                        const encryptedObj = JSON.parse(stored);
                        const dataUrl = await decryptData(encryptedObj, currentKey);
                        createCustomCardElement(key, label);
                        showStoredDocument(key, dataUrl);
                    } catch (e) { console.error(`Load custom ${key}: ${e}`); }
                } else {
                    let reg = loadCustomRegistry().filter(r => r.key !== key);
                    saveCustomRegistry(reg);
                }
            }
        }
        function triggerUpload(docType) {
            document.getElementById(`${docType}-input`).click();
        }
        function openOtherModal() {
            new bootstrap.Modal(document.getElementById('other-modal')).show();
            document.getElementById('other-name').value = '';
            document.getElementById('other-file-input').value = '';
            document.getElementById('other-message').textContent = '';
        }
        async function handleOtherUpload() {
            const name = document.getElementById('other-name').value.trim();
            const fileInput = document.getElementById('other-file-input');
            const msg = document.getElementById('other-message');
            if (!name) { msg.textContent = 'Enter a name.'; return; }
            if (!fileInput.files[0]) { msg.textContent = 'Choose a file.'; return; }
            if (!currentKey) { alert('Set password first.'); return; }
            const file = fileInput.files[0];
            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    await createAndStoreCustomDoc(name, e.target.result);
                    bootstrap.Modal.getInstance(document.getElementById('other-modal')).hide();
                } catch (err) { msg.textContent = 'Upload failed: ' + err.message; }
            };
            reader.readAsDataURL(file);
        }
        function showPasswordModal(mode) {
            const modal = document.getElementById('password-modal');
            document.getElementById('password-title').textContent = mode === 'set' ? 'Set Password' : 'Enter Password';
            modal.style.display = 'flex';
            document.getElementById('password-input').focus();
        }
        async function handlePasswordSubmit(mode) {
            const password = document.getElementById('password-input').value;
            const message = document.getElementById('password-message');
            if (!password) { message.textContent = 'Password required'; return; }
            try {
                if (mode === 'set') {
                    const salt = generateSalt();
                    currentKey = await deriveKey(password, salt);
                    const verification = await encryptData(knownVerification, currentKey);
                    localStorage.setItem('salt', base64Encode(salt));
                    localStorage.setItem('verification', JSON.stringify(verification));
                    document.getElementById('password-modal').style.display = 'none';
                    await initDocuments();
                } else {
                    const salt = base64Decode(localStorage.getItem('salt'));
                    currentKey = await deriveKey(password, salt);
                    const verification = JSON.parse(localStorage.getItem('verification'));
                    const decrypted = await decryptData(verification, currentKey);
                    if (decrypted === knownVerification) {
                        document.getElementById('password-modal').style.display = 'none';
                        await initDocuments();
                    } else { message.textContent = 'Incorrect password'; }
                }
            } catch (e) { message.textContent = 'Error: ' + e.message; }
            document.getElementById('password-input').value = '';
        }
        // Init
        document.addEventListener('DOMContentLoaded', () => {
            if (!crypto?.subtle) alert('Requires HTTPS for encryption.');
            const mode = localStorage.getItem('salt') ? 'enter' : 'set';
            showPasswordModal(mode);
            document.getElementById('submit-password').addEventListener('click', () => handlePasswordSubmit(mode));
            ['aadhar', 'pan', 'license'].forEach(docType => {
                document.getElementById(`${docType}-input`).addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (!file || !currentKey) { alert('Password required.'); return; }
                    const reader = new FileReader();
                    reader.onload = async (ev) => {
                        try {
                            const dataUrl = ev.target.result;
                            const encrypted = await encryptData(dataUrl, currentKey);
                            localStorage.setItem(docType, JSON.stringify(encrypted));
                            documents[docType] = dataUrl;
                            showStoredDocument(docType, dataUrl);
                        } catch (err) { alert('Upload failed: ' + err.message); }
                    };
                    reader.readAsDataURL(file);
                });
            });
            document.getElementById('other-add-card').addEventListener('click', openOtherModal);
            document.getElementById('other-upload-btn').addEventListener('click', handleOtherUpload);
            document.getElementById('other-modal').addEventListener('hidden.bs.modal', () => {
                document.getElementById('other-file-input').value = '';
            });
        });
    </script>
</body>
</html>